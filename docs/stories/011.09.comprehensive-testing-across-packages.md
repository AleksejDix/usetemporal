# Story 011.09: Comprehensive Testing Across All Packages

## Status

Draft

## Story

**As a** developer maintaining useTemporal,
**I want** comprehensive test coverage across all packages,
**so that** I can be confident the refactoring preserves all functionality.

## Acceptance Criteria

1. All core package tests pass (100% pass rate)
2. All Vue package tests pass (100% pass rate)
3. All React package tests pass (100% pass rate)
4. Code coverage ≥87% across all packages
5. Integration tests verify package interoperability
6. Framework-specific reactivity tests added
7. Regression tests verify no functionality lost
8. Bundle size tests verify targets met
9. Type checking passes with zero errors across all packages
10. CI/CD pipeline updated to test all packages
11. Performance benchmarks show no regression
12. Cross-package dependency tests pass

## Tasks / Subtasks

- [ ] Core package testing (AC: 1, 4)
  - [ ] Run full test suite: `TZ=UTC npm test --workspace=@allystudio/usetemporal`
  - [ ] Verify all 722 tests pass (or updated appropriately)
  - [ ] Run coverage: `npm run test:coverage --workspace=@allystudio/usetemporal`
  - [ ] Verify coverage ≥87%
  - [ ] Fix any failing tests

- [ ] Vue package testing (AC: 2, 4, 6)
  - [ ] Run test suite: `TZ=UTC npm test --workspace=@allystudio/usetemporal-vue`
  - [ ] Verify useTemporal reactivity tests pass
  - [ ] Verify usePeriod reactivity tests pass
  - [ ] Verify adapter recreation tests pass
  - [ ] Run coverage report
  - [ ] Verify coverage ≥87%

- [ ] React package testing (AC: 3, 4, 6)
  - [ ] Run test suite: `npm test --workspace=@allystudio/usetemporal-react`
  - [ ] Verify useTemporal hook tests pass
  - [ ] Verify usePeriod hook tests pass
  - [ ] Verify useState integration tests pass
  - [ ] Verify useMemo dependency tests pass
  - [ ] Run coverage report
  - [ ] Verify coverage ≥87%

- [ ] Integration testing (AC: 5, 12)
  - [ ] Test Vue package imports from core
  - [ ] Test React package imports from core
  - [ ] Verify re-exported operations work correctly
  - [ ] Test adapter sharing between packages
  - [ ] Test Period type compatibility

- [ ] Regression testing (AC: 7)
  - [ ] Create regression test suite based on alpha.1 functionality
  - [ ] Test all operations produce same results
  - [ ] Test adapter behavior unchanged
  - [ ] Test Period calculations identical
  - [ ] Document any intentional changes

- [ ] Bundle size testing (AC: 8)
  - [ ] Build all packages
  - [ ] Measure core package bundle size
  - [ ] Verify core ≤8KB gzipped
  - [ ] Measure Vue package bundle size
  - [ ] Verify Vue ≤22KB gzipped
  - [ ] Measure React package bundle size
  - [ ] Verify React ≤20KB gzipped
  - [ ] Document results

- [ ] Type checking (AC: 9)
  - [ ] Run type check on core: `npm run type-check --workspace=@allystudio/usetemporal`
  - [ ] Run type check on Vue: `npm run type-check --workspace=@allystudio/usetemporal-vue`
  - [ ] Run type check on React: `npm run type-check --workspace=@allystudio/usetemporal-react`
  - [ ] Verify zero type errors
  - [ ] Test type inference in examples

- [ ] Performance benchmarking (AC: 11)
  - [ ] Create performance benchmark suite
  - [ ] Benchmark core operations (period, divide, next)
  - [ ] Compare with alpha.1 baseline
  - [ ] Verify no significant regression (< 5% slower)
  - [ ] Document performance results

- [ ] CI/CD updates (AC: 10)
  - [ ] Update GitHub Actions workflow
  - [ ] Add test jobs for all packages
  - [ ] Add coverage reporting for all packages
  - [ ] Add bundle size checks
  - [ ] Add type checking to CI
  - [ ] Test CI pipeline runs successfully

- [ ] Example app testing
  - [ ] Test Vue example builds and runs
  - [ ] Test React example builds and runs
  - [ ] Manual testing of all features
  - [ ] Verify no console errors

## Dev Notes

### Test Execution Commands

**Run all tests across all packages:**
```bash
TZ=UTC npm test
```

**Run tests for specific package:**
```bash
TZ=UTC npm test --workspace=@allystudio/usetemporal
TZ=UTC npm test --workspace=@allystudio/usetemporal-vue
npm test --workspace=@allystudio/usetemporal-react
```

**Run with coverage:**
```bash
npm run test:coverage --workspace=@allystudio/usetemporal
npm run test:coverage --workspace=@allystudio/usetemporal-vue
npm run test:coverage --workspace=@allystudio/usetemporal-react
```

**Type checking:**
```bash
npm run type-check  # All packages
npm run type-check --workspace=@allystudio/usetemporal  # Specific package
```

### Test Coverage Requirements

| Package | Coverage Target | Current Baseline |
|---------|----------------|------------------|
| Core | ≥87% | 87.08% (alpha.1) |
| Vue | ≥87% | New package |
| React | ≥87% | New package |

### Key Test Scenarios

**Core Package:**
- [ ] All pure operations work
- [ ] Multi-adapter tests pass
- [ ] Period calculations correct
- [ ] No reactivity code remains

**Vue Package:**
- [ ] useTemporal creates reactive refs
- [ ] usePeriod watches browsing changes
- [ ] Adapter recreation triggers recalculation
- [ ] Navigation updates browsing state
- [ ] Re-exported operations work

**React Package:**
- [ ] useTemporal manages state correctly
- [ ] usePeriod uses useMemo properly
- [ ] Navigation triggers re-renders
- [ ] Adapter memoization works
- [ ] Re-exported operations work

**Integration:**
- [ ] Vue package can import from core
- [ ] React package can import from core
- [ ] Types are compatible across packages
- [ ] No circular dependencies
- [ ] Tree-shaking works correctly

### Bundle Size Validation

**Measure bundle sizes:**
```bash
npm run build --workspace=@allystudio/usetemporal
npm run build --workspace=@allystudio/usetemporal-vue
npm run build --workspace=@allystudio/usetemporal-react

# Measure gzipped sizes
find packages -name "*.js" -path "*/dist/*" -exec gzip -c {} \; | wc -c
```

**Expected sizes (gzipped):**
- Core: ≤8KB
- Vue: ≤22KB (including core)
- React: ≤20KB (including core)

### Performance Benchmarking

Create `benchmark.ts` in each package:
```typescript
import { performance } from 'perf_hooks'

const iterations = 10000

const start = performance.now()
for (let i = 0; i < iterations; i++) {
  // Operation to benchmark
}
const end = performance.now()

console.log(`Average time: ${(end - start) / iterations}ms`)
```

**Benchmark operations:**
- `period()` creation
- `divide()` operation
- `next()/previous()` navigation
- `contains()` checks

### CI/CD Configuration

**GitHub Actions workflow (.github/workflows/test.yml):**
```yaml
name: Test All Packages

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - run: npm ci
      - run: TZ=UTC npm test
      - run: npm run type-check
      - run: npm run build
      - run: npm run test:coverage
      - uses: codecov/codecov-action@v3
```

### Regression Test Examples

```typescript
// Ensure period calculations identical to alpha.1
test('period calculation regression', () => {
  const adapter = createNativeAdapter()
  const date = new Date('2025-01-15')
  const month = period(adapter, date, 'month')

  expect(month.start).toEqual(new Date('2025-01-01'))
  expect(month.end).toEqual(new Date('2025-01-31T23:59:59.999Z'))
})

// Ensure divide produces same results
test('divide regression', () => {
  const adapter = createNativeAdapter({ weekStartsOn: 1 })
  const month = period(adapter, new Date('2025-01-15'), 'month')
  const weeks = divide(adapter, month, 'week')

  expect(weeks.length).toBe(5)  // Same as alpha.1
})
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-24 | 1.0 | Story created from Epic 011 | Sarah (PO) |

## Dev Agent Record

### Agent Model Used

_To be filled by dev agent_

### Debug Log References

_To be filled by dev agent_

### Completion Notes

_To be filled by dev agent_

### File List

_To be filled by dev agent_

## QA Results

_To be filled by QA agent_
