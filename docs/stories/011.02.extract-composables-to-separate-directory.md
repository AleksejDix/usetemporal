# Story 011.02: Extract Composables to Separate Directory

## Status

Won't Do - Superseded by 011.01

## Reason for Obsolescence

Story 011.01 already completed the extraction work this story was meant to accomplish. When removing @vue/reactivity from core, Story 011.01 preserved all Vue-reactive code by renaming files to `.removed` extension:

- `createTemporal.ts.removed` (72 lines)
- `builder.ts.removed` (159 lines)
- `composables/usePeriods.ts.removed` (23 lines)
- All associated test files

These files are already "extracted" from the active codebase and ready to be copied to the Vue package in Story 011.03. Creating an intermediate `usetemporal-vue-extracted` directory is no longer necessary.

**See:** `STORY-011-SERIES-STATUS.md` for full explanation and validation findings.

**Next Step:** Proceed directly to Story 011.03 (corrected version) to create `@allystudio/usetemporal-vue` package from `.removed` files.

---

## Original Story (Archive)

### Status (Original)

Draft

## Story

**As a** developer preparing to create framework-specific packages,
**I want** Vue-specific composables extracted to a dedicated directory structure,
**so that** they can be easily moved to the new `@allystudio/usetemporal-vue` package.

## Acceptance Criteria

1. Create new directory `packages/usetemporal-vue-extracted/` for Vue-specific code
2. Move `createTemporal.ts` implementation to extracted directory
3. Move `usePeriod.ts` composable to extracted directory
4. Move any other Vue-reactive utilities to extracted directory
5. Preserve all Vue reactivity dependencies in the extracted code
6. Add temporary package.json to extracted directory
7. Ensure extracted code compiles independently
8. All tests for extracted functionality still pass
9. Document the extraction structure for next story
10. Verify no accidental code duplication between core and extracted

## Tasks / Subtasks

- [ ] Create extraction directory structure (AC: 1, 6)
  - [ ] Create `packages/usetemporal-vue-extracted/` directory
  - [ ] Create `packages/usetemporal-vue-extracted/src/` directory
  - [ ] Create `packages/usetemporal-vue-extracted/package.json` with @vue/reactivity dependency
  - [ ] Create `packages/usetemporal-vue-extracted/tsconfig.json` extending from shared config
  - [ ] Add to workspace in root `package.json`

- [ ] Move createTemporal implementation (AC: 2)
  - [ ] Copy `src/createTemporal.ts` to `usetemporal-vue-extracted/src/useTemporal.ts`
  - [ ] Rename function from `createTemporal` to `useTemporal`
  - [ ] Update imports to reference core package as dependency
  - [ ] Preserve all Vue reactivity (Ref, computed, etc.)

- [ ] Move usePeriod composable (AC: 3)
  - [ ] Copy `src/composables/usePeriod.ts` to `usetemporal-vue-extracted/src/usePeriod.ts`
  - [ ] Update imports to reference core package
  - [ ] Preserve reactive behavior

- [ ] Move Vue utilities (AC: 4)
  - [ ] Identify any other Vue-specific utilities in core
  - [ ] Move to extracted directory
  - [ ] Update cross-references

- [ ] Configure extracted package (AC: 5, 6, 7)
  - [ ] Add @vue/reactivity to dependencies
  - [ ] Add @allystudio/usetemporal to dependencies (local workspace reference)
  - [ ] Configure build script
  - [ ] Test compilation: `npm run build --workspace=usetemporal-vue-extracted`

- [ ] Update tests (AC: 8)
  - [ ] Create test directory in extracted package
  - [ ] Move relevant tests from core to extracted package
  - [ ] Update test imports
  - [ ] Run tests: `TZ=UTC npm test --workspace=usetemporal-vue-extracted`

- [ ] Document extraction (AC: 9)
  - [ ] Create README.md in extracted directory
  - [ ] Document purpose: "Temporary extraction for migration to @allystudio/usetemporal-vue"
  - [ ] List files extracted
  - [ ] Note dependencies on core package

- [ ] Verification (AC: 10)
  - [ ] Confirm no duplicate code between core and extracted
  - [ ] Verify core tests still pass (they should fail if they import removed items)
  - [ ] Verify extracted package compiles independently
  - [ ] Check workspace dependencies are correct

## Dev Notes

### Purpose of This Story

This story is a **preparatory extraction step** before creating the official `@allystudio/usetemporal-vue` package. By extracting Vue-specific code to a separate directory first, we:
1. Validate that the code can be isolated
2. Ensure all dependencies are identified
3. Test compilation independently
4. Make the next story (011.03) cleaner and safer

### Current File Locations (Before)

```
packages/usetemporal/
├── src/
│   ├── createTemporal.ts          ← Move this
│   ├── composables/
│   │   └── usePeriod.ts           ← Move this
│   └── index.ts                   ← Will be updated in story 011.04
```

### Target File Locations (After)

```
packages/usetemporal-vue-extracted/
├── src/
│   ├── useTemporal.ts             ← Renamed from createTemporal
│   ├── usePeriod.ts               ← Moved from composables/
│   └── index.ts                   ← Export both
├── package.json                   ← Temporary package config
├── tsconfig.json                  ← TypeScript config
└── README.md                      ← Extraction documentation
```

### Key Implementation Details

**Renaming createTemporal → useTemporal:**
The function should be renamed to better reflect its reactive nature:
```typescript
// Before (in core)
export function createTemporal(options: TemporalOptions): Temporal

// After (in extracted)
export function useTemporal(options: TemporalOptions): VueTemporal
```

**Dependencies:**
The extracted package will depend on:
- `@vue/reactivity`: ^3.5.18 (for reactive state)
- `@allystudio/usetemporal`: workspace:* (for core operations)

**Temporary Nature:**
This is a **temporary extraction directory**. In story 011.03, this will become the official `@allystudio/usetemporal-vue` package with proper naming, versioning, and publication setup.

### Testing

**Test Location:** Create `packages/usetemporal-vue-extracted/src/` for colocated tests

**Test Standards:**
- Use Vitest
- Test both `useTemporal` and `usePeriod` reactivity
- Ensure reactive refs trigger recalculation
- Test adapter recreation when reactive settings change

**Testing Requirements:**
- All extracted functionality tests pass
- Core tests may fail if they import removed items (expected, will fix in 011.04)
- Coverage for extracted code maintained

**Run tests:**
```bash
export TZ=UTC
npm test --workspace=usetemporal-vue-extracted
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-24 | 1.0 | Story created from Epic 011 | Sarah (PO) |

## Dev Agent Record

### Agent Model Used

_To be filled by dev agent_

### Debug Log References

_To be filled by dev agent_

### Completion Notes

_To be filled by dev agent_

### File List

_To be filled by dev agent_

## QA Results

_To be filled by QA agent_
