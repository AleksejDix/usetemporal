# Story 007.10: Documentation Validation and Testing

## Status
Draft

## Epic
007 - Tree-Shaking Architecture Refactor

## Priority
High

## Story Points
3

## Story
**As a** useTemporal maintainer,
**I want** all documentation validated and tested,
**So that** users receive accurate, working examples.

## Story Context

**Existing System Integration:**
- Depends on: Stories 007.07 (types docs), 007.08 (guide docs), 007.09 (utilities/factory docs)
- Updates: Quality assurance across ALL documentation
- Technology: Markdown linting, TypeScript compilation, documentation build
- Follows pattern: Comprehensive validation, automated testing where possible
- Touch points: All vitepress documentation, build process

**Problem Being Solved:**
After updating all documentation files in stories 007.07-007.09, we need comprehensive validation to ensure:
1. No old API patterns remain anywhere in documentation
2. All code examples actually compile and work
3. Documentation builds without errors
4. Links are not broken
5. Markdown formatting is consistent

This is the final quality gate before considering the documentation update complete.

**Impact of Incomplete Validation:**
- Old API patterns might slip through
- Broken examples frustrate users
- Build errors prevent deployment
- Broken links create poor UX
- Inconsistent formatting looks unprofessional

**Scope:**
- Comprehensive audit of ALL documentation
- Test all code examples
- Markdown linting
- Documentation build verification
- Link checking
- Final quality review

## Acceptance Criteria

**Comprehensive Audit:**
1. No occurrences of `period(temporal,` in any documentation file
2. No occurrences of `toPeriod` in any documentation file
3. No occurrences of `defineUnit` in any documentation file (except migration guide context)
4. No occurrences of `temporal.units` in any documentation file
5. No occurrences of `UNITS.` constants in any documentation file
6. No wrong package names: `@usetemporal/core`, `@usetemporal/adapter-*`

**Code Example Testing:**
7. All TypeScript code examples extracted from documentation
8. All extracted examples compile without errors
9. Examples run successfully where applicable (Node.js examples)
10. All import statements are correct

**Markdown Quality:**
11. All markdown files pass markdownlint
12. No markdown syntax errors
13. Consistent heading structure
14. Proper code block formatting

**Build and Links:**
15. Documentation builds successfully (npm run docs:build)
16. No build errors or warnings
17. All internal links work (no 404s)
18. All images/diagrams load correctly

**Final Review:**
19. Random sampling review of 10+ files shows quality and accuracy
20. Documentation is clear, concise, and beginner-friendly

## Tasks / Subtasks

### Phase 1: Comprehensive Audit

#### 1.1 Grep for Old API Patterns (AC#1-6)
- [ ] **Run comprehensive grep audit**
  ```bash
  cd /Users/aleksej/Projects/pickle

  # Pattern 1: period(temporal,
  echo "=== Checking for period(temporal, ==="
  grep -r "period(temporal," vitepress/ --exclude-dir=node_modules | wc -l

  # Pattern 2: toPeriod
  echo "=== Checking for toPeriod ==="
  grep -r "toPeriod" vitepress/ --exclude-dir=node_modules | wc -l

  # Pattern 3: defineUnit
  echo "=== Checking for defineUnit ==="
  grep -r "defineUnit" vitepress/ --exclude-dir=node_modules | wc -l

  # Pattern 4: temporal.units
  echo "=== Checking for temporal\.units ==="
  grep -r "temporal\.units" vitepress/ --exclude-dir=node_modules | wc -l

  # Pattern 5: UNITS. constants
  echo "=== Checking for UNITS\. ==="
  grep -r "UNITS\." vitepress/ --exclude-dir=node_modules | wc -l

  # Pattern 6: Wrong package names
  echo "=== Checking for @usetemporal/core ==="
  grep -r "@usetemporal/core" vitepress/ --exclude-dir=node_modules | wc -l

  echo "=== Checking for @usetemporal/adapter- ==="
  grep -r "@usetemporal/adapter-" vitepress/ --exclude-dir=node_modules | wc -l
  ```

- [ ] **Document findings**
  - Create report of any occurrences
  - Note file and line number
  - Categorize by severity

- [ ] **Verify zero occurrences (or justified exceptions)**
  - All patterns should return 0
  - Exception: Migration guide may reference old patterns in "Before" examples
  - Exception: CHANGELOG may reference removed features

#### 1.2 Review Exceptions
- [ ] **Check MIGRATION.md**
  - Old API should only be in "Before" examples
  - "After" examples must use v2.0 API
  - Verify this is correct

- [ ] **Check CHANGELOG.md**
  - May reference removed features
  - Should be in breaking changes context
  - Verify this is appropriate

- [ ] **Document any other justified exceptions**

### Phase 2: Code Example Testing

#### 2.1 Extract All Code Examples (AC#7)
- [ ] **Create extraction script**
  ```bash
  # Find all TypeScript/JavaScript code blocks
  find vitepress -name "*.md" -type f ! -path "*/node_modules/*" \
    -exec grep -l '```typescript\|```ts\|```javascript\|```js' {} \;
  ```

- [ ] **Extract examples to test files**
  - Create `docs/qa/validation/code-examples/` directory
  - Extract each example to a separate .ts file
  - Name files: `{source-file}-example-{number}.ts`
  - Add necessary imports and context

- [ ] **Create test harness**
  - TypeScript configuration for testing
  - Package.json with dependencies
  - Test runner script

#### 2.2 Compile All Examples (AC#8)
- [ ] **Setup TypeScript project**
  ```bash
  cd docs/qa/validation/code-examples
  npm init -y
  npm install typescript @allystudio/usetemporal @types/node
  ```

- [ ] **Create tsconfig.json**
  ```json
  {
    "compilerOptions": {
      "target": "ES2022",
      "module": "ESNext",
      "moduleResolution": "bundler",
      "strict": true,
      "esModuleInterop": true,
      "skipLibCheck": true,
      "noEmit": true
    }
  }
  ```

- [ ] **Compile each example**
  ```bash
  for file in *.ts; do
    echo "Compiling $file..."
    npx tsc --noEmit "$file"
    if [ $? -ne 0 ]; then
      echo "ERROR: $file failed to compile"
    fi
  done
  ```

- [ ] **Document compilation errors**
  - List all files with errors
  - Categorize errors
  - Trace back to source documentation

- [ ] **Fix all compilation errors**
  - Update source documentation
  - Re-extract and re-test
  - Verify fixes

#### 2.3 Run Examples (AC#9)
- [ ] **Identify runnable examples**
  - Node.js examples (no DOM dependencies)
  - Complete examples (not snippets)

- [ ] **Execute runnable examples**
  ```bash
  for file in *-runnable.ts; do
    echo "Running $file..."
    npx tsx "$file"
  done
  ```

- [ ] **Verify output**
  - Check for errors
  - Verify expected behavior
  - Document any issues

#### 2.4 Verify Imports (AC#10)
- [ ] **Check import patterns**
  - All should use `@allystudio/usetemporal`
  - Subpath imports should be correct
  - No old package names

- [ ] **Create import validation script**
  ```bash
  # Check for correct imports
  grep -r "from '@allystudio/usetemporal'" vitepress/ --exclude-dir=node_modules

  # Check for wrong imports
  grep -r "from '@usetemporal" vitepress/ --exclude-dir=node_modules
  ```

### Phase 3: Markdown Quality

#### 3.1 Markdown Linting (AC#11-14)
- [ ] **Install markdownlint**
  ```bash
  npm install -D markdownlint-cli
  ```

- [ ] **Create .markdownlint.json config**
  ```json
  {
    "default": true,
    "MD013": { "line_length": 120 },
    "MD033": false,
    "MD041": false
  }
  ```

- [ ] **Run markdownlint on all docs**
  ```bash
  npx markdownlint vitepress/**/*.md *.md
  ```

- [ ] **Fix all linting errors**
  ```bash
  npx markdownlint vitepress/**/*.md *.md --fix
  ```

- [ ] **Review non-auto-fixable issues**
  - Manually fix remaining issues
  - Document any exceptions

#### 3.2 Code Block Validation (AC#14)
- [ ] **Verify all code blocks have language tags**
  ```bash
  # Find code blocks without language
  grep -n "^\`\`\`$" vitepress/**/*.md
  ```

- [ ] **Verify correct language tags**
  - typescript, ts, javascript, js
  - bash, shell
  - json, yaml
  - vue

- [ ] **Fix any issues**

### Phase 4: Build and Links

#### 4.1 Documentation Build (AC#15-16)
- [ ] **Clean build**
  ```bash
  cd vitepress
  rm -rf .vitepress/dist
  npm run docs:build
  ```

- [ ] **Check for build errors**
  - Zero errors expected
  - Document any errors
  - Fix source files

- [ ] **Check for build warnings**
  - Review all warnings
  - Fix if possible
  - Document if acceptable

#### 4.2 Preview Build (AC#17)
- [ ] **Start preview server**
  ```bash
  npm run docs:preview
  ```

- [ ] **Manual navigation test**
  - Visit homepage
  - Navigate through guides
  - Navigate through API docs
  - Navigate through examples

- [ ] **Check for 404s**
  - Click internal links
  - Verify all pages load
  - Document any broken links

#### 4.3 Link Checking (AC#17)
- [ ] **Install link checker**
  ```bash
  npm install -D markdown-link-check
  ```

- [ ] **Check all markdown files**
  ```bash
  find vitepress -name "*.md" -exec markdown-link-check {} \;
  markdown-link-check README.md
  markdown-link-check MIGRATION.md
  markdown-link-check CHANGELOG.md
  ```

- [ ] **Fix broken links**
  - Update incorrect links
  - Remove dead links
  - Add missing links

#### 4.4 Image/Diagram Verification (AC#18)
- [ ] **Find all image references**
  ```bash
  grep -r "!\[.*\](" vitepress/ --exclude-dir=node_modules
  ```

- [ ] **Verify images exist**
  - Check file paths
  - Verify images load in preview

- [ ] **Fix any missing images**

### Phase 5: Final Quality Review

#### 5.1 Random Sampling Review (AC#19)
- [ ] **Select random files for review**
  - 3 from guide/
  - 3 from api/operations/
  - 2 from api/types/
  - 2 from api/utilities/
  - 1 from api/factory-functions/

- [ ] **Deep read each file**
  - Check for accuracy
  - Check for clarity
  - Check for consistency
  - Check for completeness

- [ ] **Document findings**
  - Note any issues
  - Categorize by severity
  - Create fix list

#### 5.2 Consistency Check (AC#20)
- [ ] **Terminology consistency**
  - "adapter" used consistently
  - "period" used consistently
  - "pure functions", "builder", "composables" used correctly
  - "unit" used consistently

- [ ] **Code style consistency**
  - Import patterns consistent
  - Example structure consistent
  - Naming conventions consistent

- [ ] **Voice and tone consistency**
  - Second person ("you")
  - Active voice
  - Beginner-friendly
  - Professional but approachable

#### 5.3 Learning Path Review
- [ ] **Read documentation in learning order**
  - What is useTemporal?
  - Installation
  - Getting Started
  - First App
  - Core Concepts
  - Divide Pattern
  - Operations
  - API Levels

- [ ] **Verify progressive complexity**
  - Concepts build on each other
  - No unexplained forward references
  - Clear progression

### Phase 6: Create Validation Report

#### 6.1 Document All Findings
- [ ] **Create validation report**
  - File: `docs/qa/validation/007-docs-validation-report.md`
  - Summary of all checks performed
  - Results of each check
  - Issues found and resolved
  - Final status (PASS/FAIL)

#### 6.2 Create Automated Validation Script
- [ ] **Create script for future validation**
  ```bash
  #!/bin/bash
  # docs-validation.sh

  echo "=== Documentation Validation Script ==="

  # Audit for old patterns
  echo "Checking for old API patterns..."
  # ... grep commands

  # Lint markdown
  echo "Linting markdown files..."
  npx markdownlint vitepress/**/*.md *.md

  # Build docs
  echo "Building documentation..."
  cd vitepress && npm run docs:build

  # Check links
  echo "Checking links..."
  markdown-link-check README.md

  echo "=== Validation Complete ==="
  ```

- [ ] **Document in README**
  - How to run validation
  - What it checks
  - Expected output

## Technical Notes

### Validation Checklist
```
[ ] Old API patterns: 0 occurrences
[ ] TypeScript examples: All compile
[ ] Markdown linting: All pass
[ ] Documentation build: Success
[ ] Internal links: All working
[ ] Images: All loading
[ ] Code blocks: All have language tags
[ ] Imports: All correct
[ ] Random sample: Quality confirmed
[ ] Learning path: Flows well
```

### Tools Used
- grep (pattern detection)
- TypeScript compiler (example validation)
- markdownlint (markdown quality)
- VitePress build (build verification)
- markdown-link-check (link validation)

### Expected Results
- **Old patterns**: 0 (or justified exceptions documented)
- **Compilation errors**: 0
- **Linting errors**: 0
- **Build errors**: 0
- **Broken links**: 0
- **Missing images**: 0

### Automation Opportunities
Consider adding to CI/CD:
- Automated pattern detection
- Automated example compilation
- Automated linting
- Automated link checking

## Definition of Done

- [ ] Comprehensive grep audit completed
- [ ] Zero old API patterns (or exceptions documented)
- [ ] All code examples extracted
- [ ] All code examples compile without errors
- [ ] Markdown linting passes on all files
- [ ] Documentation builds successfully
- [ ] No broken internal links
- [ ] All images load correctly
- [ ] Random sampling review completed
- [ ] Learning path verified
- [ ] Validation report created
- [ ] Automated validation script created
- [ ] All issues found have been fixed
- [ ] Documentation quality confirmed

## Risk and Compatibility Check

**Low Risk Assessment:**
- **Primary Risk:** Missing some edge case issue
- **Impact**: LOW - Validation is comprehensive
- **Mitigation**: Multiple validation methods, random sampling
- **Rollback**: N/A (documentation only)

**Compatibility Verification:**
- No code changes
- No database changes
- No UI component changes
- Performance impact: N/A (validation only)

## Dev Notes

### Recommended Workflow
1. Start with comprehensive grep audit (fastest to identify issues)
2. Extract and compile code examples (validates examples work)
3. Run markdown linting (catches formatting issues)
4. Build documentation (catches build errors)
5. Check links (catches navigation issues)
6. Do random sampling review (catches quality issues)
7. Create validation report
8. Create automated script for future use

### Success Criteria
This story is complete when:
- All automated checks pass
- No old API patterns remain
- All examples work
- Documentation builds cleanly
- Quality review confirms excellence

### Validation Report Template
```markdown
# Documentation Validation Report - Epic 007

Date: [Date]
Validator: [Name]
Stories: 007.05, 007.07, 007.08, 007.09

## Audit Results
- Old API patterns: 0 occurrences ✓
- Example compilation: 100% success ✓
- Markdown linting: All pass ✓
- Build: Success ✓
- Links: All working ✓
- Images: All loading ✓

## Issues Found: [N]
[List any issues]

## Issues Fixed: [N]
[List fixes]

## Final Status: PASS / FAIL
```

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-14 | 1.0 | Initial story creation from 007.05 breakdown | Sarah (PO) |

## Dev Agent Record

_To be filled by developer when work begins_

## QA Results

_To be filled by QA reviewer_
