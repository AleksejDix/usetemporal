# Story 011.05: Create @allystudio/usetemporal-react Package

## Status

Draft

## Story

**As a** React developer,
**I want** an official React integration package with hooks,
**so that** I can use useTemporal with React state management and hooks.

## Acceptance Criteria

1. Create new package directory `packages/usetemporal-react/`
2. Initialize package.json with name `@allystudio/usetemporal-react`
3. Set version to 2.0.0-beta.1
4. Add React as peer dependency (^18.0.0)
5. Configure package.json exports for tree-shaking
6. Implement `useTemporal` React hook
7. Implement `usePeriod` React hook
8. Re-export core operations for convenience
9. Generate TypeScript type definitions
10. All package tests pass
11. Package builds successfully
12. README.md with React-specific usage examples
13. Add package to monorepo workspace

## Tasks / Subtasks

- [ ] Create package structure (AC: 1, 13)
  - [ ] Create `packages/usetemporal-react/` directory
  - [ ] Create `packages/usetemporal-react/src/` directory
  - [ ] Add to workspace in root package.json
  - [ ] Create tsconfig.json extending shared config

- [ ] Configure package.json (AC: 2, 3, 4, 5)
  - [ ] Set name: `@allystudio/usetemporal-react`
  - [ ] Set version: `2.0.0-beta.1`
  - [ ] Add description: "React hooks for useTemporal"
  - [ ] Add peerDependencies: react ^18.0.0
  - [ ] Add dependencies: @allystudio/usetemporal workspace:*
  - [ ] Configure exports map
  - [ ] Set `"sideEffects": false`

- [ ] Implement useTemporal hook (AC: 6)
  - [ ] Create src/useTemporal.ts
  - [ ] Accept adapter via options (can be memoized)
  - [ ] Accept initial date via options
  - [ ] Manage browsing state with useState
  - [ ] Manage now state with useState
  - [ ] Implement next() function with setState
  - [ ] Implement previous() function with setState
  - [ ] Implement go() function with setState
  - [ ] Return ReactTemporal interface

- [ ] Implement usePeriod hook (AC: 7)
  - [ ] Create src/usePeriod.ts
  - [ ] Accept temporal instance and unit type
  - [ ] Use useMemo to compute period from temporal.browsing
  - [ ] Return Period that updates when browsing changes

- [ ] Create type definitions (AC: 9)
  - [ ] Create src/types.ts
  - [ ] Define ReactTemporal interface
  - [ ] Define UseTemporalOptions interface
  - [ ] Export all relevant types

- [ ] Create exports (AC: 8)
  - [ ] Create src/index.ts
  - [ ] Export useTemporal hook
  - [ ] Export usePeriod hook
  - [ ] Re-export all core operations
  - [ ] Re-export all adapters
  - [ ] Re-export all types

- [ ] Configure build (AC: 11)
  - [ ] Create vite.config.ts
  - [ ] Configure entry point
  - [ ] Configure externals (react, core package)
  - [ ] Add vite-plugin-dts for type generation
  - [ ] Add build script
  - [ ] Test: `npm run build --workspace=@allystudio/usetemporal-react`

- [ ] Write tests (AC: 10)
  - [ ] Set up React Testing Library
  - [ ] Test useTemporal hook state management
  - [ ] Test usePeriod hook reactivity
  - [ ] Test navigation functions (next, previous, go)
  - [ ] Test adapter memoization
  - [ ] Run: `npm test --workspace=@allystudio/usetemporal-react`

- [ ] Create README.md (AC: 12)
  - [ ] Installation instructions
  - [ ] Basic usage with hooks
  - [ ] useTemporal API documentation
  - [ ] usePeriod API documentation
  - [ ] Example: reactive adapter with useMemo
  - [ ] Example: calendar component
  - [ ] Link to main documentation

## Dev Notes

### Package Structure

```
packages/usetemporal-react/
├── src/
│   ├── useTemporal.ts       # Main React hook
│   ├── usePeriod.ts         # Period hook
│   ├── types.ts             # React-specific types
│   ├── index.ts             # Main exports
│   └── *.test.tsx           # Tests with React Testing Library
├── package.json             # Package configuration
├── tsconfig.json            # TypeScript config
├── vite.config.ts           # Build configuration
└── README.md                # Package documentation
```

### ReactTemporal Interface

```typescript
import type { Adapter, Period, Unit } from '@allystudio/usetemporal'

export interface ReactTemporal {
  adapter: Adapter              // Current adapter
  browsing: Period              // Current browsing period
  now: Period                   // Current time period
  next: () => void              // Navigate to next period
  previous: () => void          // Navigate to previous period
  go: (direction: number, count?: number) => void
}

export interface UseTemporalOptions {
  adapter: Adapter              // Adapter (use useMemo for reactive)
  date?: Date                   // Initial browsing date
}
```

### useTemporal Implementation Pattern

```typescript
import { useState, useCallback, useMemo } from 'react'
import { period, next as nextOp, previous as prevOp } from '@allystudio/usetemporal/operations'

export function useTemporal(options: UseTemporalOptions): ReactTemporal {
  const { adapter, date = new Date() } = options

  const [browsingDate, setBrowsingDate] = useState(date)
  const [nowDate] = useState(new Date())

  const browsing = useMemo(
    () => period(adapter, browsingDate, 'month'),
    [adapter, browsingDate]
  )

  const now = useMemo(
    () => period(adapter, nowDate, 'month'),
    [adapter, nowDate]
  )

  const next = useCallback(() => {
    const nextPeriod = nextOp(adapter, browsing)
    setBrowsingDate(nextPeriod.date)
  }, [adapter, browsing])

  const previous = useCallback(() => {
    const prevPeriod = prevOp(adapter, browsing)
    setBrowsingDate(prevPeriod.date)
  }, [adapter, browsing])

  return { adapter, browsing, now, next, previous, go }
}
```

### usePeriod Implementation Pattern

```typescript
import { useMemo } from 'react'
import { period } from '@allystudio/usetemporal/operations'
import type { ReactTemporal, Unit, Period } from './types'

export function usePeriod(
  temporal: ReactTemporal,
  unit: Unit
): Period {
  return useMemo(
    () => period(temporal.adapter, temporal.browsing.date, unit),
    [temporal.adapter, temporal.browsing, unit]
  )
}
```

### Example Usage (for README)

```typescript
import { useMemo, useState } from 'react'
import { useTemporal, usePeriod } from '@allystudio/usetemporal-react'
import { createNativeAdapter, divide } from '@allystudio/usetemporal-react'

function Calendar() {
  const [weekStartsOn, setWeekStartsOn] = useState(1)  // Monday

  // Adapter recreates when weekStartsOn changes
  const adapter = useMemo(
    () => createNativeAdapter({ weekStartsOn }),
    [weekStartsOn]
  )

  const temporal = useTemporal({ adapter, date: new Date() })
  const month = usePeriod(temporal, 'month')
  const weeks = divide(adapter, month, 'week')

  return (
    <div>
      <button onClick={() => setWeekStartsOn(0)}>
        Start week on Sunday
      </button>
      <button onClick={temporal.previous}>Previous</button>
      <button onClick={temporal.next}>Next</button>
      {/* Render calendar grid with weeks */}
    </div>
  )
}
```

### Dependencies

**package.json:**
```json
{
  "peerDependencies": {
    "react": "^18.0.0"
  },
  "dependencies": {
    "@allystudio/usetemporal": "workspace:*"
  },
  "devDependencies": {
    "@testing-library/react": "^14.0.0",
    "@testing-library/react-hooks": "^8.0.0",
    "@types/react": "^18.0.0"
  }
}
```

### Testing

**Test Requirements:**
- Use React Testing Library
- Test hook state updates
- Test navigation triggers re-renders
- Test useMemo dependencies work correctly
- Test adapter recreation pattern

**Test Example:**
```typescript
import { renderHook, act } from '@testing-library/react'
import { useTemporal } from './useTemporal'
import { createNativeAdapter } from '@allystudio/usetemporal/native'

test('useTemporal navigation', () => {
  const adapter = createNativeAdapter()
  const { result } = renderHook(() =>
    useTemporal({ adapter, date: new Date('2025-01-15') })
  )

  const initialMonth = result.current.browsing.date.getMonth()

  act(() => {
    result.current.next()
  })

  expect(result.current.browsing.date.getMonth()).toBe(initialMonth + 1)
})
```

**Run tests:**
```bash
npm test --workspace=@allystudio/usetemporal-react
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-24 | 1.0 | Story created from Epic 011 | Sarah (PO) |

## Dev Agent Record

### Agent Model Used

_To be filled by dev agent_

### Debug Log References

_To be filled by dev agent_

### Completion Notes

_To be filled by dev agent_

### File List

_To be filled by dev agent_

## QA Results

_To be filled by QA agent_
