# Story 010.04: Create YearGridView Component

## Status
Draft

## Story
**As a** developer building the divide visualization,  
**I want** a Vue component that displays a year as a 3x4 grid of months,  
**So that** users can see the full year view and interact with individual months.

## Story Context

**Existing System Integration:**
- Integrates with: useCalendarData, useCalendarInteraction composables
- Technology: Vue 3 SFC, TypeScript, CSS Grid
- Follows pattern: Component using headless composables
- Touch points: Parent DivideVisualization component, Period type

## Acceptance Criteria

**Functional Requirements:**
1. Displays 12 months in a 3x4 grid layout
2. Each month shows its name and mini calendar preview
3. Hover state highlights individual months
4. Click on month triggers navigation event
5. Current month has visual indicator
6. Keyboard navigation works across grid

**Integration Requirements:**
7. Uses periods from useCalendarData composable
8. Integrates useCalendarInteraction for events
9. Emits month-selected event to parent
10. Accepts year period as prop

**Quality Requirements:**
11. Responsive grid adapts to container width
12. Smooth hover transitions (200ms)
13. ARIA grid semantics for accessibility
14. Loading state while data fetches

## Technical Notes

- **Integration Approach:** SFC with composition API, CSS Grid layout
- **Existing Pattern Reference:** Similar to calendar grid examples but simplified
- **Key Constraints:** Must work within VitePress component system

## Definition of Done

- [ ] Component created at `/vitepress/.vitepress/components/YearGridView.vue`
- [ ] Props interface defined with TypeScript
- [ ] 3x4 CSS Grid layout implemented
- [ ] Month cells with name and mini preview
- [ ] Hover states with transitions
- [ ] Click handling with event emission
- [ ] Keyboard navigation across grid
- [ ] Current month highlighting
- [ ] Loading state implementation
- [ ] Unit tests for component logic
- [ ] Visual tests for layout
- [ ] Storybook story (if applicable)
- [ ] Accessibility audit passed

## Risk and Compatibility Check

**Minimal Risk Assessment:**
- **Primary Risk:** CSS Grid browser support
- **Mitigation:** Modern browsers all support Grid
- **Rollback:** Could fall back to Flexbox

**Compatibility Verification:**
- [ ] No breaking changes (new component)
- [ ] No database changes
- [ ] CSS Grid compatible with target browsers
- [ ] Performance acceptable with 12 month cells

## Dev Notes

### Component Structure

```vue
<!-- YearGridView.vue -->
<template>
  <div 
    class="year-grid-view"
    role="grid"
    :aria-label="`Year ${yearLabel}`"
    @keydown="handleKeyDown"
  >
    <div class="year-header">
      <h2>{{ yearLabel }}</h2>
    </div>
    
    <div class="months-grid">
      <div
        v-for="(month, index) in months"
        :key="month.start.toISOString()"
        :ref="el => monthRefs[index] = el"
        class="month-cell"
        :class="{
          'is-current': isCurrentMonth(month),
          'is-hovered': hoveredPeriod?.start === month.start,
          'is-focused': focusedPeriod?.start === month.start
        }"
        role="gridcell"
        :tabindex="focusedIndex === index ? 0 : -1"
        :aria-label="getMonthLabel(month)"
        @click="handleMonthClick(month)"
        @mouseenter="handlePeriodHover(month)"
        @mouseleave="handlePeriodHover(null)"
        @focus="focusPeriod(month, index)"
      >
        <div class="month-header">
          {{ formatMonthName(month) }}
        </div>
        
        <div class="month-preview">
          <!-- Mini calendar preview -->
          <div class="mini-calendar">
            <div 
              v-for="week in getMonthWeeks(month)" 
              :key="week"
              class="mini-week"
            >
              <div 
                v-for="day in 7" 
                :key="day"
                class="mini-day"
                :class="{ 'is-filled': isDayInMonth(week, day, month) }"
              />
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div v-if="isLoading" class="loading-overlay">
      <div class="loading-spinner" />
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, watch } from 'vue'
import type { Period } from '@usetemporal/core'
import { isSame } from '@usetemporal/core'

interface Props {
  yearPeriod: Period
  months: Period[]
  currentPeriod?: Period
  isLoading?: boolean
}

const props = defineProps<Props>()

const emit = defineEmits<{
  'month-selected': [month: Period]
  'navigate': [direction: string]
}>()

// Get interaction composable from parent or create new
const {
  hoveredPeriod,
  focusedPeriod,
  focusedIndex,
  handlePeriodHover,
  handleKeyDown: handleInteractionKeyDown,
  focusPeriod,
  navigateGrid
} = useCalendarInteraction({
  onPeriodClick: (period) => emit('month-selected', period),
  onNavigate: (direction) => {
    if (direction === 'in') {
      // Navigate into month
      if (focusedPeriod.value) {
        emit('month-selected', focusedPeriod.value)
      }
    } else {
      // Grid navigation
      navigateGrid(direction, 3) // 3 columns
    }
  }
})

// Template refs for focus management
const monthRefs = ref<HTMLElement[]>([])

// Computed
const yearLabel = computed(() => {
  return props.yearPeriod.date.getFullYear().toString()
})

// Methods
function formatMonthName(month: Period): string {
  return month.date.toLocaleDateString('en', { month: 'short' })
}

function isCurrentMonth(month: Period): boolean {
  if (!props.currentPeriod) return false
  return isSame(temporal, month, props.currentPeriod, 'month')
}

function getMonthLabel(month: Period): string {
  const name = month.date.toLocaleDateString('en', { month: 'long', year: 'numeric' })
  return isCurrentMonth(month) ? `${name} (current)` : name
}

function handleMonthClick(month: Period) {
  emit('month-selected', month)
}

// Mini calendar helpers
function getMonthWeeks(month: Period): number {
  // Calculate number of weeks in month view
  const firstDay = month.start.getDay()
  const daysInMonth = month.end.getDate()
  return Math.ceil((firstDay + daysInMonth) / 7)
}

function isDayInMonth(week: number, day: number, month: Period): boolean {
  // Simplified - just show pattern
  const firstDay = month.start.getDay()
  const dayNumber = (week - 1) * 7 + day - firstDay
  return dayNumber > 0 && dayNumber <= month.end.getDate()
}

// Watch for focus changes and update DOM
watch(focusedIndex, (index) => {
  if (index >= 0 && index < monthRefs.value.length) {
    monthRefs.value[index]?.focus()
  }
})
</script>

<style scoped>
.year-grid-view {
  --grid-gap: 1.5rem;
  --cell-padding: 1rem;
  --hover-scale: 1.05;
  --transition-duration: 200ms;
  
  position: relative;
  width: 100%;
}

.year-header {
  text-align: center;
  margin-bottom: 2rem;
}

.year-header h2 {
  font-size: 2rem;
  font-weight: 300;
  color: var(--vp-c-text-1);
}

.months-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(4, 1fr);
  gap: var(--grid-gap);
  margin: 0 auto;
}

.month-cell {
  background: var(--vp-c-bg-soft);
  border: 1px solid var(--vp-c-divider);
  border-radius: 8px;
  padding: var(--cell-padding);
  cursor: pointer;
  transition: all var(--transition-duration) ease;
  position: relative;
  overflow: hidden;
}

.month-cell:hover,
.month-cell.is-hovered {
  transform: scale(var(--hover-scale));
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  border-color: var(--vp-c-brand-1);
}

.month-cell.is-focused {
  outline: 2px solid var(--vp-c-brand-1);
  outline-offset: 2px;
}

.month-cell.is-current {
  background: var(--vp-c-brand-soft);
  border-color: var(--vp-c-brand-1);
}

.month-header {
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: var(--vp-c-text-1);
}

/* Mini calendar preview */
.mini-calendar {
  display: grid;
  grid-template-rows: repeat(6, 1fr);
  gap: 2px;
  opacity: 0.6;
}

.mini-week {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 2px;
}

.mini-day {
  aspect-ratio: 1;
  background: var(--vp-c-divider);
  border-radius: 2px;
}

.mini-day.is-filled {
  background: var(--vp-c-brand-2);
}

/* Loading state */
.loading-overlay {
  position: absolute;
  inset: 0;
  background: rgba(255, 255, 255, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
}

.loading-spinner {
  width: 2rem;
  height: 2rem;
  border: 2px solid var(--vp-c-divider);
  border-top-color: var(--vp-c-brand-1);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Responsive */
@media (max-width: 768px) {
  .months-grid {
    grid-template-columns: repeat(2, 1fr);
    grid-template-rows: repeat(6, 1fr);
  }
}

@media (max-width: 480px) {
  .months-grid {
    grid-template-columns: 1fr;
    grid-template-rows: auto;
  }
}
</style>
```

### Usage Example

```vue
<template>
  <YearGridView
    :year-period="currentYear"
    :months="months"
    :current-period="currentPeriod"
    :is-loading="isLoading"
    @month-selected="handleMonthSelected"
    @navigate="handleNavigate"
  />
</template>

<script setup>
const { currentYear, months, isLoading } = useCalendarData()

function handleMonthSelected(month) {
  navigateToMonth(month.date.toLocaleDateString('en', { month: 'long' }), month)
}
</script>
```

### Testing Approach

1. **Unit Tests**: Props, events, computed properties
2. **Integration Tests**: With composables
3. **Visual Tests**: Layout in different states
4. **Accessibility Tests**: Keyboard nav, ARIA

### Performance Notes

- Use `v-show` for hover states (no re-render)
- Memoize month calculations
- CSS transforms for animations (GPU)
- Lazy render mini calendars if needed

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-07-27 | 1.0 | Initial story creation | Sarah (PO) |

## Dev Agent Record
(To be populated by dev agent)

## QA Results
(To be populated by QA agent)